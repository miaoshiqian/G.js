<!DOCTYPE html>
<html>
    <head>
        <title>G.js test</title>
        <script type="text/javascript">
            document.domain = 'gjs.com';
        </script>
        <meta charset="UTF-8" />
        <script type="text/javascript" src="../dist/g-debug.js"  charset="UTF-8"></script>
    </head>
<body>
<div id="mocha"></div>
<script type="text/javascript">
G.config({
    debug   : true,
    servers : ['http://gjs.com'],
    base    : '/src/',
    version : {
        'util/storage/localStorage.js': 100000
    },
    alias   : {
        'jquery': 'lib/jquery/jquery-1.8.2.js',
        'localStorage': 'util/storage/localStorage.js'
    },
    combine : {
        'util/storage/storage.cmb.js': ['localStorage', './cookie.js', '.flashCookie.js']
    }
});
G.use(['require', 'Promise', './expect.js', './mocha.js', './mocha.css'], function ( require ) {
    var mocha = require('./mocha.js');
    var except = require('./expect.js');
    var Promise = require('Promise');
    var allTest = [];
    mocha.setup('bdd');

    var localStorageTest = Promise.defer();
    allTest.push(localStorageTest);
    G.use(['require', 'util/storage/localStorage.js'], function ( require ) {
        var Storage = require('util/storage/localStorage.js');

        describe('localStorage', function(){
            it('data between to different namespace won\'t be shared', function () {
                var S1 = new Storage('S1');
                var S2 = new Storage('S2');
                S1.set('foo', 'bar');
                S2.set('foo', 'notbar');
                except(S1.get('foo')).to.be('bar');
                except(S2.get('foo')).not.to.be('bar');
                S1.clear();
                except(S2.get('foo')).to.be('notbar');
                S2.clear();
            });
            it('data will gone after clear', function () {
                var s = new Storage('CL');
                s.set('f1', 'f1');
                s.set('f2', 'f2');
                s.clear();
                except(s.get('f1')).to.be(null);
                except(s.get('f2')).to.be(null);
            });
            it('all data will gone after global clear', function () {
                var s1 = new Storage('S1');
                var s2 = new Storage('S2');
                s1.set('foo', 'bar');
                s2.set('pub', 'hub');
                Storage.clear();
                except(s1.get('foo')).to.be(null);
                except(s2.get('pub')).to.be(null);
            });
        });
        localStorageTest.done();
    });
    Promise.when(allTest).done(function () {
        mocha.run().globals(['match']);
    });
});
</script>
</body>
</html>